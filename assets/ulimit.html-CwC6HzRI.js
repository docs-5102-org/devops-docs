import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as e,o as n}from"./app-Chw5Q7wx.js";const l={};function t(h,i){return n(),a("div",null,i[0]||(i[0]=[e(`<h1 id="ulimit命令-linux系统资源限制管理" tabindex="-1"><a class="header-anchor" href="#ulimit命令-linux系统资源限制管理"><span>ulimit命令-Linux系统资源限制管理</span></a></h1><h2 id="什么是ulimit" tabindex="-1"><a class="header-anchor" href="#什么是ulimit"><span>什么是ulimit？</span></a></h2><p>ulimit（user limit的缩写）是Linux系统中的一个内置shell命令，用于控制shell进程及其启动的子进程可以使用的资源量。通过ulimit，系统管理员可以限制用户对系统资源的使用，如最大文件大小、最大内存使用量、最大进程数等，从而提高系统的稳定性和安全性。</p><h2 id="基本语法" tabindex="-1"><a class="header-anchor" href="#基本语法"><span>基本语法</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [选项] [限制值]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果不指定限制值，则显示当前资源限制；如果指定限制值，则设置新的资源限制。</p><h2 id="常用选项" tabindex="-1"><a class="header-anchor" href="#常用选项"><span>常用选项</span></a></h2><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td><code>-a</code></td><td>显示当前所有的资源限制</td></tr><tr><td><code>-c</code></td><td>设置或显示core文件的最大值（单位：块）</td></tr><tr><td><code>-d</code></td><td>设置或显示进程数据段的最大值（单位：KB）</td></tr><tr><td><code>-f</code></td><td>设置或显示可创建文件的最大值（单位：块）</td></tr><tr><td><code>-H</code></td><td>设置硬资源限制（只有root用户可以提高硬限制）</td></tr><tr><td><code>-l</code></td><td>设置或显示可锁定内存的最大值（单位：KB）</td></tr><tr><td><code>-m</code></td><td>设置或显示可使用内存的最大值（单位：KB）</td></tr><tr><td><code>-n</code></td><td>设置或显示可打开文件描述符的最大数量</td></tr><tr><td><code>-p</code></td><td>设置或显示管道缓冲区大小（单位：512字节）</td></tr><tr><td><code>-s</code></td><td>设置或显示堆栈大小的最大值（单位：KB）</td></tr><tr><td><code>-S</code></td><td>设置软资源限制（任何用户都可以修改，但不能超过硬限制）</td></tr><tr><td><code>-t</code></td><td>设置或显示CPU使用时间的最大值（单位：秒）</td></tr><tr><td><code>-u</code></td><td>设置或显示用户可创建的最大进程数</td></tr><tr><td><code>-v</code></td><td>设置或显示可用虚拟内存的最大值（单位：KB）</td></tr></tbody></table><h2 id="软限制与硬限制" tabindex="-1"><a class="header-anchor" href="#软限制与硬限制"><span>软限制与硬限制</span></a></h2><p>在Linux系统中，资源限制分为两种类型：</p><ol><li><strong>软限制（Soft Limit）</strong>：当前有效的资源限制，用户可以临时增加到硬限制值。</li><li><strong>硬限制（Hard Limit）</strong>：软限制的上限，只有root用户才能增加硬限制。</li></ol><h3 id="查看软限制和硬限制" tabindex="-1"><a class="header-anchor" href="#查看软限制和硬限制"><span>查看软限制和硬限制</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看所有软限制</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Sa</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看所有硬限制</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Ha</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用示例" tabindex="-1"><a class="header-anchor" href="#使用示例"><span>使用示例</span></a></h2><h3 id="查看当前资源限制" tabindex="-1"><a class="header-anchor" href="#查看当前资源限制"><span>查看当前资源限制</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 显示当前用户的所有资源限制</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>输出示例：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>core file size          (blocks, -c) 0</span></span>
<span class="line"><span>data seg size           (kbytes, -d) unlimited</span></span>
<span class="line"><span>scheduling priority             (-e) 0</span></span>
<span class="line"><span>file size               (blocks, -f) unlimited</span></span>
<span class="line"><span>pending signals                 (-i) 46621</span></span>
<span class="line"><span>max locked memory       (kbytes, -l) 64</span></span>
<span class="line"><span>max memory size         (kbytes, -m) unlimited</span></span>
<span class="line"><span>open files                      (-n) 1024</span></span>
<span class="line"><span>pipe size            (512 bytes, -p) 8</span></span>
<span class="line"><span>POSIX message queues     (bytes, -q) 819200</span></span>
<span class="line"><span>real-time priority              (-r) 0</span></span>
<span class="line"><span>stack size              (kbytes, -s) 8192</span></span>
<span class="line"><span>cpu time               (seconds, -t) unlimited</span></span>
<span class="line"><span>max user processes              (-u) 46621</span></span>
<span class="line"><span>virtual memory          (kbytes, -v) unlimited</span></span>
<span class="line"><span>file locks                      (-x) unlimited</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="限制进程数量" tabindex="-1"><a class="header-anchor" href="#限制进程数量"><span>限制进程数量</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 限制当前用户最多可以创建500个进程</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 500</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="限制文件大小" tabindex="-1"><a class="header-anchor" href="#限制文件大小"><span>限制文件大小</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 限制可创建的最大文件为100KB</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="限制可打开文件数" tabindex="-1"><a class="header-anchor" href="#限制可打开文件数"><span>限制可打开文件数</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 限制可同时打开的文件数为2000</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="限制虚拟内存使用" tabindex="-1"><a class="header-anchor" href="#限制虚拟内存使用"><span>限制虚拟内存使用</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 限制虚拟内存使用为1GB</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1048576</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="core-dump设置" tabindex="-1"><a class="header-anchor" href="#core-dump设置"><span>Core Dump设置</span></a></h2><p>Core dump是程序异常终止时产生的内存映像，对于调试程序崩溃非常有用。通过ulimit命令可以控制core dump文件的生成。</p><h3 id="查看当前core文件大小限制" tabindex="-1"><a class="header-anchor" href="#查看当前core文件大小限制"><span>查看当前core文件大小限制</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看当前core文件大小限制</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果返回值为0，表示系统不会生成core文件。</p><h3 id="启用core-dump" tabindex="-1"><a class="header-anchor" href="#启用core-dump"><span>启用core dump</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 允许生成core文件，不限制大小</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unlimited</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置core文件最大为100块（51200字节）</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用core文件调试" tabindex="-1"><a class="header-anchor" href="#使用core文件调试"><span>使用core文件调试</span></a></h3><p>当程序崩溃时，系统会在当前目录生成core文件，可以使用gdb进行调试：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用gdb调试core文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./程序名</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> core文件名</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>例如：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./test</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> core.2065</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="配置core-dump文件名和位置" tabindex="-1"><a class="header-anchor" href="#配置core-dump文件名和位置"><span>配置core dump文件名和位置</span></a></h2><h3 id="添加进程id到core文件名" tabindex="-1"><a class="header-anchor" href="#添加进程id到core文件名"><span>添加进程ID到core文件名</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使core文件名包含进程ID</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/proc/sys/kernel/core_uses_pid</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自定义core文件名格式和路径" tabindex="-1"><a class="header-anchor" href="#自定义core文件名格式和路径"><span>自定义core文件名格式和路径</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 编辑系统配置文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/sysctl.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加以下内容</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">kernel.core_pattern</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/core/core_%e_%p</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">kernel.core_uses_pid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使配置立即生效</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sysctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/sysctl.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>core文件名格式中的占位符含义：</p><ul><li><code>%e</code> - 程序文件名</li><li><code>%p</code> - 进程ID</li><li><code>%h</code> - 主机名</li><li><code>%t</code> - 转储时间（从1970年1月1日起的秒数）</li><li><code>%u</code> - 进程的实际用户ID</li><li><code>%g</code> - 进程的实际组ID</li><li><code>%s</code> - 导致转储的信号编号</li><li><code>%c</code> - 转储文件的大小上限</li></ul><h2 id="永久设置ulimit" tabindex="-1"><a class="header-anchor" href="#永久设置ulimit"><span>永久设置ulimit</span></a></h2><p>临时设置的ulimit只在当前shell会话中有效，重启后会恢复默认值。要永久设置ulimit，可以：</p><h3 id="_1-修改系统配置文件" tabindex="-1"><a class="header-anchor" href="#_1-修改系统配置文件"><span>1. 修改系统配置文件</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 编辑/etc/security/limits.conf文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/security/limits.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加配置，例如：</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">* soft nofile 10000     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 所有用户的软限制</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">* hard nofile 10000     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 所有用户的硬限制</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> soft</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nofile</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 65536</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # root用户的软限制</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置格式：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>&lt;domain&gt; &lt;type&gt; &lt;item&gt; &lt;value&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>domain: 用户名、组名（@组名）或通配符*（所有用户）</li><li>type: soft（软限制）或hard（硬限制）</li><li>item: 资源名称，如nofile（打开文件数）、nproc（进程数）等</li><li>value: 限制值</li></ul><h3 id="_2-修改用户配置文件" tabindex="-1"><a class="header-anchor" href="#_2-修改用户配置文件"><span>2. 修改用户配置文件</span></a></h3><p>在<code>~/.bashrc</code>或<code>/etc/profile</code>中添加ulimit命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在/etc/profile中添加（对所有用户生效）</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unlimited</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改后执行<code>source /etc/profile</code>使配置立即生效，或重新登录。</p><h2 id="检查进程的资源限制" tabindex="-1"><a class="header-anchor" href="#检查进程的资源限制"><span>检查进程的资源限制</span></a></h2><h3 id="查看特定进程的限制" tabindex="-1"><a class="header-anchor" href="#查看特定进程的限制"><span>查看特定进程的限制</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看进程ID为1234的资源限制</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/1234/limits</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看进程已使用的文件描述符数量" tabindex="-1"><a class="header-anchor" href="#查看进程已使用的文件描述符数量"><span>查看进程已使用的文件描述符数量</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看进程ID为1234已打开的文件描述符数量</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ls</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/1234/fd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -l</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="常见问题诊断" tabindex="-1"><a class="header-anchor" href="#常见问题诊断"><span>常见问题诊断</span></a></h2><h3 id="问题-too-many-open-files" tabindex="-1"><a class="header-anchor" href="#问题-too-many-open-files"><span>问题：Too many open files</span></a></h3><p>当进程尝试打开的文件数超过ulimit -n设置的限制时，会出现&quot;Too many open files&quot;错误。</p><p><strong>解决方法</strong>：</p><ol><li>临时增加限制：<code>ulimit -n 4096</code></li><li>永久增加限制：修改<code>/etc/security/limits.conf</code></li></ol><h3 id="问题-无法生成core文件" tabindex="-1"><a class="header-anchor" href="#问题-无法生成core文件"><span>问题：无法生成core文件</span></a></h3><p><strong>解决方法</strong>：</p><ol><li>检查core文件大小限制：<code>ulimit -c</code></li><li>设置不限制core文件大小：<code>ulimit -c unlimited</code></li><li>确认core_pattern设置：<code>cat /proc/sys/kernel/core_pattern</code></li></ol><h2 id="最佳实践" tabindex="-1"><a class="header-anchor" href="#最佳实践"><span>最佳实践</span></a></h2><ol><li><strong>根据应用需求设置合理的限制</strong>：不同应用对资源的需求不同，应根据实际情况设置。</li><li><strong>监控资源使用情况</strong>：定期检查系统和重要进程的资源使用情况。</li><li><strong>在生产环境中谨慎修改</strong>：修改系统资源限制可能影响系统稳定性。</li><li><strong>为关键应用设置更高的限制</strong>：数据库、Web服务器等通常需要更高的文件描述符限制。</li><li><strong>记录修改</strong>：记录所有对系统资源限制的修改，以便故障排除。</li></ol><p>通过合理配置ulimit，可以有效防止单个用户或进程耗尽系统资源，提高系统的稳定性和安全性。</p>`,72)]))}const p=s(l,[["render",t]]),c=JSON.parse(`{"path":"/linux/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7/ulimit.html","title":"ulimit命令-系统资源限制管理","lang":"zh-CN","frontmatter":{"title":"ulimit命令-系统资源限制管理","category":["Linux","系统监控"],"tag":["ulimit","资源限制","core dump","系统管理"],"date":"2022-09-09T00:00:00.000Z","description":"ulimit命令-Linux系统资源限制管理 什么是ulimit？ ulimit（user limit的缩写）是Linux系统中的一个内置shell命令，用于控制shell进程及其启动的子进程可以使用的资源量。通过ulimit，系统管理员可以限制用户对系统资源的使用，如最大文件大小、最大内存使用量、最大进程数等，从而提高系统的稳定性和安全性。 基本语法...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ulimit命令-系统资源限制管理\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-09-09T00:00:00.000Z\\",\\"dateModified\\":\\"2025-07-09T15:12:33.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"tuonioooo\\",\\"url\\":\\"/\\"}]}"],["meta",{"property":"og:url","content":"https://mister-hope.github.io/devops-docs/linux/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7/ulimit.html"}],["meta",{"property":"og:site_name","content":"tuonioooo's DevOps Docs"}],["meta",{"property":"og:title","content":"ulimit命令-系统资源限制管理"}],["meta",{"property":"og:description","content":"ulimit命令-Linux系统资源限制管理 什么是ulimit？ ulimit（user limit的缩写）是Linux系统中的一个内置shell命令，用于控制shell进程及其启动的子进程可以使用的资源量。通过ulimit，系统管理员可以限制用户对系统资源的使用，如最大文件大小、最大内存使用量、最大进程数等，从而提高系统的稳定性和安全性。 基本语法..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-07-09T15:12:33.000Z"}],["meta",{"property":"article:tag","content":"系统管理"}],["meta",{"property":"article:tag","content":"core dump"}],["meta",{"property":"article:tag","content":"资源限制"}],["meta",{"property":"article:tag","content":"ulimit"}],["meta",{"property":"article:published_time","content":"2022-09-09T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-07-09T15:12:33.000Z"}]]},"git":{"createdTime":1752073953000,"updatedTime":1752073953000,"contributors":[{"name":"tuonioooo","username":"tuonioooo","email":"daizhaoman@sina.com","commits":1,"url":"https://github.com/tuonioooo"}]},"readingTime":{"minutes":5.66,"words":1697},"filePathRelative":"linux/系统管理与监控/ulimit.md","excerpt":"\\n<h2>什么是ulimit？</h2>\\n<p>ulimit（user limit的缩写）是Linux系统中的一个内置shell命令，用于控制shell进程及其启动的子进程可以使用的资源量。通过ulimit，系统管理员可以限制用户对系统资源的使用，如最大文件大小、最大内存使用量、最大进程数等，从而提高系统的稳定性和安全性。</p>\\n<h2>基本语法</h2>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code class=\\"language-bash\\"><span class=\\"line\\"><span style=\\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\\">ulimit</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\"> [选项] [限制值]</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>","autoDesc":true}`);export{p as comp,c as data};
