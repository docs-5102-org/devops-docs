---
title: cp命令-复制
# icon: copy
category:
  - Linux
  - 命令帮助
tag:
  - cp
  - 文件管理
  - 复制
date: 2022-07-22

---

# cp命令-复制

## 命令概述

`cp` 命令来自英文单词 "copy" 的缩写，中文译为"复制"，其功能是复制文件或目录。cp命令能够将一个或多个文件或目录复制到指定位置，亦常用于文件的备份工作。

## 语法格式

```bash
cp [参数] 源文件/目录 目标文件/目录
```

## 常用参数

| 参数 | 功能描述 |
|------|----------|
| `-a` | 功能等价于 `-pdr` 参数组合，保留所有属性并递归复制 |
| `-b` | 覆盖目标文件前先进行备份 |
| `-d` | 复制链接文件时，将目标文件也建立为链接文件 |
| `-f` | 若目标文件已存在，则会直接覆盖，不询问 |
| `-i` | 若目标文件已存在，则会询问是否覆盖 |
| `-l` | 对源文件建立硬链接，而非复制文件 |
| `-p` | 保留源文件或目录的所有属性信息（权限、时间戳等） |
| `-r` | 递归复制所有子文件和子目录 |
| `-s` | 对源文件建立软链接，而非复制文件 |
| `-u` | 仅当源文件比目标文件新或目标文件不存在时才复制 |
| `-v` | 显示执行过程详细信息 |
| `-P` | 保留源文件的路径结构 |
| `-S` | 指定备份文件的后缀（与-b一起使用） |

## 重要提示

- **`-r` 参数**：用于递归操作，复制目录时若忘记添加则会直接报错
- **`-f` 参数**：用于当目标文件已存在时会直接覆盖而不再询问
- **`-p` 参数**：在需要保留文件权限、时间戳等属性时非常有用

## 参考示例

### 1. 复制文件并重命名

复制指定的源文件，并定义新文件的名称：

```bash
cp File1.cfg File2.cfg
```

### 2. 递归复制目录

复制指定的源目录，并定义新目录的名称：

```bash
cp -r Dir1 Dir2
```

### 3. 保留文件属性复制

复制文件时，保留其原始权限及用户归属信息：

```bash
cp -a File1.cfg File2.cfg
```

### 4. 强制覆盖复制

将指定文件复制到 `/etc` 目录中，并覆盖已有文件，不进行询问：

```bash
cp -f File1.cfg /etc
```

### 5. 批量复制文件

将多个文件一同复制到 `/etc` 目录中，如已有目标文件名称则默认询问是否覆盖：

```bash
cp File1.cfg File2.cfg /etc
cp: overwrite '/etc/File1.cfg'? y
```

### 6. 复制目录内的所有文件到目标目录

```bash
# 如果dir2目录不存在，则可以直接使用
cp -r dir1 dir2

# 如果dir2目录已存在，复制dir1中的内容到dir2中
cp -r dir1/. dir2
```

### 7. 创建备份复制

复制文件时，如果目标文件已存在，则先创建备份：

```bash
# 默认添加~作为备份后缀
cp -b file.txt /destination/

# 指定备份后缀
cp -b -S .bak file.txt /destination/
```

### 8. 保留目录结构复制

复制文件时保留源文件的目录结构：

```bash
cp -P /var/log/messages /backup/
```

## 高级用法

### 结合其他命令使用

```bash
# 查找并复制所有.txt文件
find . -name "*.txt" -exec cp {} /destination/ \;

# 复制多个文件并显示进度
ls *.jpg | xargs -I{} cp -v {} /destination/
```

### 复制时排除特定文件

```bash
# 使用rsync命令实现复制时排除特定文件
rsync -av --exclude='*.tmp' source_dir/ destination_dir/
```

## 使用建议

1. **备份重要文件**：使用 `cp` 命令前，建议先备份重要文件
2. **谨慎使用 `-f` 参数**：该参数会直接覆盖已存在的文件，请确认操作正确性
3. **复制目录必须使用 `-r`**：否则会报错
4. **保留文件属性**：使用 `-a` 参数可以完整保留文件的所有属性信息
5. **交互式复制**：在批量操作时，建议使用 `-i` 参数以避免意外覆盖

## 常见问题解决

### 复制时提示"omitting directory"

这是因为复制目录时没有使用 `-r` 参数，解决方法是添加该参数：

```bash
cp -r source_directory destination_directory
```

### 复制后文件权限改变

默认情况下，复制的文件会采用用户的umask设置。如需保留原文件权限，使用 `-p` 或 `-a` 参数：

```bash
cp -p source_file destination_file
```

## 总结

`cp` 命令是 Linux 系统中最基础和常用的文件操作命令之一，掌握其各种参数的使用方法对于日常系统管理和文件操作非常重要。灵活运用各种选项可以满足不同场景下的文件复制需求。
