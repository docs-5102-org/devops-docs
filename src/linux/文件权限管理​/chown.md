---
title: chown命令-文件所有权管理
category:
  - Linux
  - 文件权限管理
tag:
  - chown
  - 文件所有权
  - 用户管理
  - 系统安全
date: 2022-07-31

---

# chown命令-文件所有权管理

## 一、前言

Linux下所有资源、设备均被视作文件来操作，而文件权限则是决定用户可各文件操作的范围，无论是平时使用Linux，还是写程序均涉及这方面。本指南详细介绍Linux文件权限系统和chown命令的使用。

## 二、Linux文件权限类型详解

### 1. 普通权限

| 权限 | 文件 | 目录 |
|------|------|------|
| **r（读权限）** | 查看文件内容 | 列出其子目录结构信息（可执行 `ls 目录`） |
| **w（写权限）** | 配合r权限，则可对文件进行修改和删除 | 配合x权限就可以添加、删除和移动内部文件，而删除目录和复制目录内文件则需要配合r和x权限 |
| **x（执行权限）** | 配合r权限，可执行的权限 | 可以进入该目录和对其下文件作操作（可执行 `cd 目录`） |

### 2. 特殊权限

**场景1：** 用户A在调用程序B时，且程序B需要修改文件C，而用户A无权修改文件C，那么程序B同样将被拒绝修改文件C。

**原因：** 程序将使用调用者（就是用户A）的用户标识去对系统作操作，程序的权限与调用者的权限一致。

**解决办法：** 使用特殊权限SUID和SGID。

| 权限 | 文件 | 目录 |
|------|------|------|
| **SUID** | 注意：仅对二进制可执行文件设置<br>二进制可执行文件会以所有者和调用者的用户标识去执行，也就是拥有两者的权限 | 不对目录设置 |
| **SGID** | 注意：仅对二进制可执行文件设置<br>二进制可执行文件会以所属组和调用者的标识去执行，也就是拥有两者的权限 | 在目录下创建文件、目录等，其所属组与该目录的所属组相同。而不是所有者的用户组了 |

**场景2：** 某用户在执行 `rm -rf 目录/*` 时，把所有者不是它的文件、目录都误删除了。

**原因：** 默认情况下，只要用户拥有某目录的wx权限，则可以删除、剪切该目录下的所有文件、目录，即使该用户对该目录下的文件、目录任何权限都没有。

**解决办法：** 使用特殊权限SBIT。

| 权限 | 文件 | 目录 |
|------|------|------|
| **SBIT（stick bit，粘滞位）** | 不对文件设置 | 配合wx权限，仅目录的所有者、子目录或文件的所有者和root用户才能删除、移动该目录下的子目录和文件 |


[](../_resources/CentOS6.5菜鸟之旅：文件权限详解.resources/unknown_filename.3.gif)

### 3. 隐藏权限

共13种，仅在文件系统格式为Ext2+才有效。

## 三、通过命令了解权限

### 1. 查看权限

输入 `ls -l` 就可以查看当前目录下所有文件和子目录的权限信息。

假设回显信息为：`-rwsr-xr-x 1 root root 430540 Dec 20 18:27 /usr/sbin/passwd`

逐一分析其内容：
- ①首字符`-`：表示该文件为普通文件
  - `-`：普通文件
  - `d`：目录文件
  - `l`：符号链接
  - `c`：字符设备文件
  - `b`：字节设备文件
  - `p`：先进先出文件
  - `s`：套接字文件
- ②第2~4个字符：表示所有者（owner）的权限
- ③第5~7个字符：表示所属组（group）的权限
- ④第8~10个字符：表示其他用户（other）的权限
- ⑤第11个字符：表示硬链接数
- ⑥文件所有者的用户名称（owner）
- ⑦文件所属组的用户组名称（group）
- ⑧文件大小，以块为单位，通过 `ls -lh` 则会以KB，MB作单位
- ⑨最后修改日期
- ⑩文件或目录的绝对路径

从上述内容我们可以得知Linux下的权限角色有三种，分别是**所有者（owner）**、**所属组（group）**和**其他用户（other）**。

### 2. 权限表示形式

#### [a]. 符号表示法

**普通权限：**
- `r`：读权限
- `w`：写权限
- `x`：可执行权限

**特殊权限：**
- SUID权限只能设置在所有者权限位中，`s`表示二进制可执行文件同时拥有SUID权限和x可执行权限；`S`表示二进制可执行文件拥有SUID权限但没有x可执行权限。
- SGID权限只能设置在所属组权限位中，`s`表示二进制可执行文件或目录同时拥有SGID权限和x可执行权限；`S`表示二进制可执行文件或目录拥有SGID权限但没有x可执行权限。
- SBIT权限只能设置在其他用户权限位中，`t`表示目录同时拥有SBIT权限和x可执行权限；`T`表示目录拥有SBIT权限但没有x可执行权限。

#### [b]. 数字表示法

数字表示法采用二进制形式计算，八进制形式设置的方式。
二进制形式计算，1代表有权限，0代表无权限：

| | | | **所有者** | | | **所属组** | | | **其他用户** | | |
|---|---|---|---|---|---|---|---|---|---|---|---|
| **SUID** | **SGID** | **SBIT** | **R** | **W** | **X** | **R** | **W** | **X** | **R** | **W** | **X** |
| 1/0 | 1/0 | 1/0 | 1/0 | 1/0 | 1/0 | 1/0 | 1/0 | 1/0 | 1/0 | 1/0 | 1/0 |

然后每三位为一组转为八进制，例如现在二进制形式为100111101101，那么转为八进制则为4755。

然后通过 `chmod 4755 文件` 就可以改变文件的权限，`ls -l` 回显中权限部分则为`rwsr-xr-x`。

**注意：**
1. 若不设置特殊权限时，我们可以直接省去八进制的第一位数，例如：`chmod 755 文件`
2. 采用数字表示法设置特殊权限，仅能启动特殊权限，却无法关闭。例如，文件A拥有特殊权限SUID和SGID，执行 `chmod 0755 文件A`，但通过 `ls -l` 查看权限依然为`rwsr-sr-x`。

## 四、通过符号表示法设置权限

### 设置普通权限

```bash
# 为所有者、所属组和其他用户添加执行的权限
chmod +x 文件路径

# 为所有者、所属组和其他用户删除执行的权限
chmod -x 文件路径

# 为所有者添加执行的权限
chmod u+x 文件路径

# 为所属组添加执行的权限
chmod g+x 文件路径

# 为其他用户添加执行的权限
chmod o+x 文件路径

# 为所有者、所属组添加执行的权限
chmod ug+x 文件路径

# 为所有者、所属组和其他用户添加写、执行的权限，取消读权限
chmod =wx 文件路径

# 为所有者、所属组添加写、执行的权限，取消读权限
chmod ug=wx 文件路径
```

### 设置特殊权限

```bash
# 开启、关闭SUID
chmod u+s 文件名
chmod u-s 文件名

# 开启、关闭SGID
chmod g+s 文件名
chmod g-s 文件名

# 开启、关闭SBIT
chmod o+t 文件名
chmod o-t 文件名
```

## 五、chown命令详解

### 1. chown命令概述

在Linux中，文件所有权对于安全性和用户管理至关重要。chown命令，或"change owner"，允许用户修改文件和目录所有权，便于访问控制。只有root（或文件的当前所有者）才能运行它。

### 2. chown命令语法

语法：chown [选项] 所有者[:组] 文件…；使用-R递归应用更改。

```bash
chown [选项] 用户名[:组名] 文件或目录
```

### 3. 基本用法示例

#### 改变文件所有者

```bash
# 改变单个文件的所有者
chown john file.txt

# 改变多个文件的所有者
chown john file1.txt file2.txt file3.txt

# 使用通配符改变多个文件的所有者
chown john *.txt
```

#### 改变文件所有者和组

```bash
# 同时改变所有者和组
chown john:developers file.txt

# 使用点号分隔符（等同于冒号）
chown john.developers file.txt

# 只改变组（保持所有者不变）
chown :developers file.txt
```

#### 递归改变目录及其内容的所有权

```bash
# 递归改变目录及其所有子目录和文件的所有权
chown -R john:developers /home/project/

# 递归改变但保持符号链接不变
chown -h john file_link
```

### 4. 常用选项

| 选项 | 描述 |
|------|------|
| `-R, --recursive` | 递归地改变目录及其子目录和文件的所有权 |
| `-c, --changes` | 仅当发生更改时显示信息 |
| `-f, --silent, --quiet` | 禁止大多数错误消息 |
| `-v, --verbose` | 为每个处理的文件输出诊断信息 |
| `--reference=RFILE` | 使用RFILE的所有者和组而不是指定OWNER:GROUP值 |
| `-h, --no-dereference` | 影响符号链接本身而不是引用的文件 |

### 5. 实际应用示例

#### 示例1：Web服务器文件权限设置

```bash
# 将网站文件的所有权转移给web服务器用户
sudo chown -R www-data:www-data /var/www/html/

# 设置日志文件的所有权
sudo chown syslog:adm /var/log/myapp.log
```

#### 示例2：新用户目录设置

```bash
# 创建新用户目录并设置正确的所有权
sudo mkdir /home/newuser
sudo chown newuser:users /home/newuser
sudo chmod 755 /home/newuser
```

#### 示例3：数据库文件权限

```bash
# 设置MySQL数据目录的所有权
sudo chown -R mysql:mysql /var/lib/mysql/
```

### 6. 使用UID和GID

```bash
# 使用用户ID和组ID（当用户名不存在时有用）
chown 1000:1000 file.txt

# 查看用户的UID和GID
id username
```

### 7. 错误处理和最佳实践

#### 常见错误信息

- `Operation not permitted`：没有足够权限，需要使用sudo
- `Invalid user`：指定的用户不存在
- `Invalid group`：指定的组不存在

#### 最佳实践

1. **使用sudo**：普通用户改变文件所有权通常需要管理员权限
2. **验证用户和组存在**：使用前确认用户和组名正确
3. **小心使用递归选项**：`-R` 选项会影响所有子文件和目录
4. **备份重要文件**：在批量更改前备份重要数据
5. **测试命令**：在小范围内测试命令效果

## 六、查看用户信息

```bash
# 查看当前用户
whoami

# 查看当前用户所属组
groups

# 查看其他用户所属组
groups 用户1 用户2

# 查看用户详细信息
id username
```

## 七、其他相关命令

### 1. chgrp命令（改变组所有权）

```bash
# 改变文件组所有权
chgrp developers file.txt

# 递归改变目录组所有权
chgrp -R developers /project/
```

### 2. 组合使用示例

```bash
# 先改变所有权，再设置权限
chown john:developers file.txt
chmod 755 file.txt

# 或者一步完成
chown john:developers file.txt && chmod 755 file.txt
```

## 八、用户和用户组管理

### 1. 添加用户

```bash
# 添加用户
useradd [-u uid] [-g group] [-d home] [-s shell] 用户名

# 示例：添加用户garfield
useradd garfield

# 设置密码
passwd garfield
```

### 2. 用户操作

```bash
# 禁用用户
usermod -L 用户名

# 启用用户
usermod -U 用户名

# 将用户添加到组
usermod -G 用户组名 用户

# 改变用户的主组
usermod -g 用户组名 用户

# 修改用户名
usermod -l 新用户名 旧用户名

# 删除用户
userdel 用户名
```

### 3. 用户组管理

```bash
# 添加用户组
groupadd [-g gid [-o]] [-r] [-f] 用户组名

# 修改用户组名称
groupmod -n 新用户组名 旧用户组名

# 删除用户组
groupdel 用户组名
```

## 九、重要配置文件

### 1. /etc/passwd
存放用户信息，格式：
`用户名:密码:用户ID:组ID:注释:家目录:Shell`

### 2. /etc/shadow
存放加密密码和密码策略，仅root可读。

### 3. /etc/group
存放组信息，格式：
`组名:密码:组ID:成员列表`

## 十、安全注意事项

1. **谨慎使用root权限**：只在必要时使用sudo
2. **验证命令参数**：确保用户名、组名和文件路径正确
3. **定期审查文件权限**：使用`find`命令查找异常权限的文件
4. **日志监控**：监控chown命令的使用情况
5. **最小权限原则**：只给予必要的最小权限

## 总结

Linux文件权限系统是系统安全的基础，chown命令作为权限管理的重要工具，允许管理员精确控制文件和目录的所有权。正确理解和使用这些概念对于Linux系统管理至关重要。通过合理配置文件权限和所有权，可以确保系统的安全性和稳定性。
