---
title: expr命令-用于求表达式的值
category:
  - Linux
  - 命令帮助
tag:
  - expr
  - 表达式计算
  - 字符串处理
  - shell编程
date: 2022-08-05

---

# expr命令-用于求表达式的值

Expr命令用于求表达式的值，是Shell脚本中常用的命令之一，可以进行整数运算、字符串处理等操作。

## 命令格式

```bash
expr Expression
```

## 基本规则

使用expr命令时，需要遵循以下规则：

1. 用空格隔开每个项
2. 用反斜杠`\`放在shell特定字符前面
3. 对包含空格和其他特殊字符的字符串要用引号括起来

## 运算符

以下是expr支持的运算符，按优先级从低到高排列：

### 逻辑运算符

| 运算符 | 描述 |
| --- | --- |
| `\|` | 如果第一个表达式非零或非空，返回第一个表达式的值，否则返回第二个表达式的值 |
| `&` | 如果两个表达式都非零或非空，返回第一个表达式的值，否则返回0 |

### 比较运算符

| 运算符 | 描述 |
| --- | --- |
| `=` | 等于（字符串或整数） |
| `>` | 大于（字符串或整数） |
| `>=` | 大于等于（字符串或整数） |
| `<` | 小于（字符串或整数） |
| `<=` | 小于等于（字符串或整数） |
| `!=` | 不等于（字符串或整数） |

### 算术运算符

| 运算符 | 描述 |
| --- | --- |
| `+` | 加法 |
| `-` | 减法 |
| `*` | 乘法（需要转义：`\*`） |
| `/` | 除法 |
| `%` | 取余 |

### 字符串运算符

| 运算符 | 描述 |
| --- | --- |
| `:` | 正则表达式匹配 |
| `match` | 与`:`相同，匹配正则表达式 |
| `length` | 返回字符串长度 |
| `index` | 返回字符串中包含子串中任意字符的第一个位置 |
| `substr` | 返回子字符串 |

## 使用示例

### 整数运算

```bash
# 加法
expr 5 + 3
# 输出: 8

# 减法
expr 10 - 4
# 输出: 6

# 乘法（需要转义*）
expr 3 \* 4
# 输出: 12

# 除法
expr 20 / 5
# 输出: 4

# 取余
expr 17 % 5
# 输出: 2
```

### 字符串处理

```bash
# 字符串长度
expr length "Hello World"
# 输出: 11

# 提取子字符串（从位置11开始，长度为6）
expr substr "Goodnight Ladies" 11 6
# 输出: Ladies

# 查找字符位置
expr index "abcdef" "d"
# 输出: 4

# 查找多个字符中任意一个的位置
expr index "abcdef" "fd"
# 输出: 4（f在d之前）
```

### 正则表达式匹配

```bash
# 匹配字符串开头的数字
expr "123abc" : "[0-9]*"
# 输出: 3

# 提取匹配的部分
expr "hello123" : ".*\([0-9]*\)"
# 输出: 123
```

### 条件判断

```bash
# 如果第一个表达式为真，返回第一个表达式的值
expr 5 \| 3
# 输出: 5

# 如果两个表达式都为真，返回第一个表达式的值
expr 5 \& 3
# 输出: 5

# 比较两个数字
expr 10 \> 5
# 输出: 1（表示真）

expr 5 \>= 10
# 输出: 0（表示假）
```

## 在Shell脚本中的应用

### 变量递增

```bash
#!/bin/bash
COUNT=1
COUNT=`expr $COUNT + 1`
echo $COUNT
# 输出: 2
```

### 获取字符串长度

```bash
#!/bin/bash
STR="Hello World"
LENGTH=`expr length "$STR"`
echo "字符串长度: $LENGTH"
# 输出: 字符串长度: 11
```

### 提取子字符串

```bash
#!/bin/bash
# 提取字符串中的数字部分
STRING="version-1.2.3"
VERSION=`expr "$STRING" : "version-\(.*\)"`
echo $VERSION
# 输出: 1.2.3
```

### 在条件语句中使用

```bash
#!/bin/bash
# 检查输入是否以y或Y开头
if expr "$ANSWER" : "[yY]" > /dev/null; then
    echo "用户回答了是"
else
    echo "用户回答了否"
fi
```

## 注意事项

1. 所有运算符两侧必须有空格
2. 特殊字符（如`*`, `(`, `)`, `<`, `>`, `&`, `|`等）需要用反斜杠转义
3. 变量和表达式最好用双引号括起来，避免空值或包含空格的值导致错误
4. 当表达式的值为空或0时，expr命令的退出状态为1；否则为0
5. 对于复杂的数学运算，可以考虑使用`bc`命令

## 与其他命令的比较

- **bc**: 更适合复杂的数学计算
- **awk**: 更适合文本处理和复杂计算
- **sed**: 更适合文本替换和正则表达式操作

## 实用技巧

### 避免特殊字符问题

当变量可能与expr运算符冲突时，可以在变量前添加字符前缀：

```bash
# 如果$STR可能是"="，会导致语法错误
expr "$STR" = "="  # 错误

# 正确的做法
expr "x$STR" = "x="  # 正确
```

### 静默输出

将输出重定向到/dev/null，只使用退出状态：

```bash
if expr "$STRING" : "^[0-9]*$" > /dev/null; then
    echo "字符串只包含数字"
fi
```

